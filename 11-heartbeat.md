# 11. ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆã¨ãƒ—ãƒ­ã‚¢ã‚¯ãƒ†ã‚£ãƒ–è¡Œå‹•

## ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆã¨ã¯

Clawdbotã¯å®šæœŸçš„ã«ã€Œãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆã€ã‚’å—ã‘å–ã‚‹ã€‚
ã“ã‚Œã‚’æ´»ç”¨ã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é ¼ã¾ã‚Œãªãã¦ã‚‚è¡Œå‹•ã§ãã‚‹ã€‚

## HEARTBEAT.mdã®è¨­å®š

```markdown
# HEARTBEAT.md

ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆæ™‚ã«ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã“ã¨:
- [ ] æœªèª­ãƒ¡ãƒ¼ãƒ«ç¢ºèª
- [ ] ä»Šæ—¥ã®ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼
- [ ] ThreadsæŠ•ç¨¿ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
- [ ] å¤©æ°—ï¼ˆå¤–å‡ºäºˆå®šãŒã‚ã‚‹å ´åˆï¼‰
```

ç©ºã«ã™ã‚‹ã¨ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆã‚’ã‚¹ã‚­ãƒƒãƒ—ï¼ˆHEARTBEAT_OKï¼‰ã€‚

## ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆ vs Cron

| ç”¨é€” | ãƒãƒ¼ãƒˆãƒ“ãƒ¼ãƒˆ | Cron |
|-----|------------|------|
| è¤‡æ•°ãƒã‚§ãƒƒã‚¯ã‚’ã¾ã¨ã‚ã‚‹ | âœ… | âŒ |
| æ­£ç¢ºãªæ™‚åˆ»ãŒå¿…è¦ | âŒ | âœ… |
| ä¼šè©±ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒå¿…è¦ | âœ… | âŒ |
| ç‹¬ç«‹ã—ãŸã‚¿ã‚¹ã‚¯ | âŒ | âœ… |

## ãƒã‚§ãƒƒã‚¯çŠ¶æ…‹ã®ç®¡ç†

`memory/heartbeat-state.json`:

```json
{
  "lastChecks": {
    "email": 1707300000,
    "calendar": 1707290000,
    "weather": 1707200000,
    "threads": 1707300000
  }
}
```

## ãƒ—ãƒ­ã‚¢ã‚¯ãƒ†ã‚£ãƒ–è¡Œå‹•ã®ä¾‹

### 1. ãƒ¡ãƒ¼ãƒ«é€šçŸ¥

```python
# é‡è¦ãªãƒ¡ãƒ¼ãƒ«ãŒã‚ã‚Œã°é€šçŸ¥
if has_urgent_email():
    send_message("ğŸ“§ é‡è¦ãªãƒ¡ãƒ¼ãƒ«ãŒå±Šã„ã¦ã¾ã™ï¼šã€‡ã€‡ã‹ã‚‰")
```

### 2. ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãƒªãƒã‚¤ãƒ³ãƒ‰

```python
# 2æ™‚é–“ä»¥å†…ã®ã‚¤ãƒ™ãƒ³ãƒˆ
if upcoming_events_within(hours=2):
    send_message("ğŸ“… 14:00ã‹ã‚‰ã€ŒMTGã€ãŒã‚ã‚Šã¾ã™")
```

### 3. å®šæœŸãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹

```python
# ãƒ¡ãƒ¢ãƒªæ•´ç†ï¼ˆé€±1å›ï¼‰
if days_since_last_cleanup() > 7:
    cleanup_memory()
    update_memory_md()
```

## ã„ã¤è©±ã—ã‹ã‘ã‚‹ã‹

### âœ… è©±ã—ã‹ã‘ã‚‹ã¹ãæ™‚

- é‡è¦ãªãƒ¡ãƒ¼ãƒ«ãŒå±Šã„ãŸ
- ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚¤ãƒ™ãƒ³ãƒˆãŒè¿‘ã„ï¼ˆ< 2æ™‚é–“ï¼‰
- ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸ
- é•·æœŸã‚¿ã‚¹ã‚¯ãŒå®Œäº†ã—ãŸ

### âŒ é»™ã‚‹ã¹ãæ™‚

- æ·±å¤œï¼ˆ23:00-08:00ï¼‰â€»ç·Šæ€¥ä»¥å¤–
- å‰å›ãƒã‚§ãƒƒã‚¯ã‹ã‚‰å¤‰åŒ–ãªã—
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ˜ã‚‰ã‹ã«å¿™ã—ã„

## å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

```python
def on_heartbeat():
    state = load_heartbeat_state()
    now = time.time()
    
    # æœ€å¾Œã®ãƒã‚§ãƒƒã‚¯ã‹ã‚‰30åˆ†ä»¥ä¸ŠçµŒé
    if now - state["lastChecks"]["email"] > 1800:
        check_email()
        state["lastChecks"]["email"] = now
    
    # æ¯å›ãƒã‚§ãƒƒã‚¯
    check_upcoming_events()
    
    save_heartbeat_state(state)
```
